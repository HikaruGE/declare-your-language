\chapter{Getting Spoofax}

In this chapter we discuss how to install Spoofax and setting up language
projects.

\section{Eclipse + Spoofax}

Spoofax is an Eclipse plugin. Hence, the regular way to install an Eclipse
plugin is to use its update site to add the plugin to an existing Eclipse
installation. However, Spoofax requires a few tweaks to be applied to the
Eclipse configuration and it requires the separate installation of Java 7 or
later. To avoid all this hassle, Spoofax is now also distributed as a
complete Eclipse installation with Spoofax pre-installed and all configurations
set corectly. The download page

\begin{quote}
  \url{http://metaborg.org/download}
\end{quote}

\noindent
provides a link to the integrated distributions. Note that this distribution is
currently only available for the bleeding edge continuous build version of
Spoofax. 

Download the \texttt{spoofax-<os>-<arch>-jre.zip} for your computer's operating
 system and architecture, unzip, and launch the Eclipse application inside.
 
The first thing that Eclipse will ask is which Workspace to use. The Workspace
is the default directory where projects are created. Just create a new directory
with an appropriate name (e.g. \texttt{Workspace-Spoofax}) in an appropriate
location in your file system.

The first thing that I do when installing a new Eclipse is changing its
appearance. In the Eclipse menu choose \texttt{Preferences}. In the dialog
window go to \texttt{General > Appearance} and choose theme \texttt{Classic}. 

Another setting that is useful to adjust is that for refresh. In the search 
box in the Preference dialog type 'refresh'. Under \texttt{Startup and Shutdown} 
select \texttt{Refresh workspace on startup}. Under \texttt{Workspace} unselect
\texttt{Build automatically} and select \texttt{Refresh on access}.

The default font size is configured to be 11pt, which is too small for my eyes. 
Adjust the font size in the \texttt{Preferences > General > Appearance > Colors
and Fonts}, and there select \texttt{Basic > Text Font} and choose something
appropriate. I find 14pt Monaco to work out pretty well.

\begin{sidenote}{JRE Error}

At the first time that I try out the Eclipse with
pre-packaged JRE, I get the following error: 

\begin{quote}
'Update Installed JREs' has encountered a problem.
Resource '/.org.eclipse.jdt.core.external.folders' already exists.
\end{quote} 

\noindent
After ignoring the error, Spoofax appears to work fine. It is not clear at this
point whether that is due to the fact that I had already installed JRE8.

\end{sidenote} 

\section{Creating a Project}

To start a new language with Spoofax you need to create an Eclipse project.

In the \texttt{File} menu select \texttt{New > Project \ldots}. In the dialog
window select \texttt{Spoofax editor project} and hit the \texttt{Next >}
button. This presents the \texttt{Spoofax Editor Project} wizard dialog in
which you should indicate the name and file extension of your project
and language. This information is used to instantiate all the files that are
needed in a Spoofax project.

The wizard will create a project directory in your Workspace with the following
properties:

\begin{description}
\item[Project name] This will be the name of your project and the directory that
contains it.
\item[Language name] This is the name of your language, which means that it will
be used as the basis for several file names.
\item[Plugin ID and package name] This is the name of the Java
package and plugin that is generated from your project.
\item[File extensions] This is the file extension that the program files in
your language will have 
\item[Generate .gitignore file] Of course you will maintain your project's
version history in git. Check the box so that generated code that needs not to
be versioned is ignored by git.
\item[Generate minimal project only] Check this box to start with a fresh
language. In this book I will walk you through building the various elements
that you need for your language.
\end{description}

Choosing the name for your language is important. Unfortunately, the name that
you choose will be hardwired at many places in your project. Therefore,
\textbf{renaming} your project and language afterwards \textbf{is virtually
impossible}.
The usual way to achieve a renaming is to create a new project with the right
name and manually copy over the files from your old project.

\section{Importing an Existing Project}

Another way to use Spoofax is to import an existing project. The
\BookOnGithub{github repository} for this book provides a series of example
projects which are the basis for the text in the book. To use those projects
check out the git repository and import the projects into Eclipse as follows.
In the \texttt{File} menu select \texttt{Import \ldots}. In the import dialog
select \texttt{General > Existing Project into Workspace}. Browse to the
\texttt{declare-your-language/languages} directory and select a project to
import (or select the entire directory, which will allow you to import all
projects at once). In the \texttt{Projects:} are select all projects that you
want to import. Hit the \texttt{Finish} button. 

Importing a project will add it to your workspace without copying it to the
Workspace directory.

You can remove a project from your workspace using \texttt{Edit > Delete}. This
will not remove the files from the file system, unless you select that option
using the check box.

\section{Structure of a Spoofax Project}

The Spoofax Editor Project wizard generates a complete Eclipse plugin project
for your language. All that is left to do is fill in the language-specific bits.
That is great, but the sheer number of directories and files in a project may
seem rather overwhelming. However, it is not all that bad. You can ignore most
of this stuff, certainly at first. Let's have a look what the wizard has
generated.

\begin{itemize}

  \item \texttt{.cache/}: A cache of intermediate results produced by processing
  the language definition.
  \item \texttt{.externalToolBuilders/}: Automatically generated Ant files.
  \item \texttt{.settings/}: Eclipse settings
  \item \texttt{editor/}: This directory contains \texttt{*.esv} files, which
  configure various aspects of the IDE for your language. Here you can change
  the color that syntax highlighting gives to certain tokens of your syntax, or
  define the outline view for programs in your language. A basic definition of
  these configurations is generated automatically. 
  \item \texttt{editor/java}: This sub-directory of the \texttt{editor/}
  directory is unrelated to the configuration files. It contains some
  project-specific Java code that binds it to the language-independent Spoofax
  framework. The directory is also used as target for Java code generated from
  the DynSem meta-language for dynamic semantics.
  \item \texttt{icons/}: This is where icons to be used in the outline view go.
  It is empty by default.
  \item \texttt{include/}: This directory contains files that are generated from
  the syntax definition for the language. (Eventually these files will end up
  in the \texttt{src-gen} directory.)
  \item \texttt{lib/}: This directory contains the common run-time library for
  Spoofax projects. (Eventually this should be a binary dependency.)
  \item \texttt{META-INF/}: This directory contains the manifest with
  configuration information for building the Eclipse plugin.
  \item \texttt{src-gen/}: This directory contains code generated from the
  language definition.
  \item \texttt{syntax/}: This is where one typically puts the modules making up
  the syntax definition. In today's Spoofax, syntax definitions are defined
  using the SDF3 syntax definition formalism.
  \item \texttt{target/}: This directory contains the result of the compilation
  of Java code.
  \item \texttt{trans/}: This is where one usually puts the transformations
  defining the non-syntactic aspects of a language definition, including
  source-to-source transformations, interpretation, and code generation. All
  these aspects used to be defined using the Stratego transformation language.
  \item \texttt{utils/}: This directory contains Spoofax Java libraries.
\end{itemize}

Then there are some files at the top level of the project:

\begin{itemize}
  \item \texttt{.classpath}:
  \item \texttt{.gitignore}:
  \item \texttt{.project}:
  \item \texttt{build.properties}: 
  \item \texttt{build.generated.xml}: 
  \item \texttt{build.main.xml}: 
  \item \texttt{plugin.xml}: 
  \item \texttt{pom.xml}: 
\end{itemize}

In summary, only the \texttt{editor/}, \texttt{syntax/}, and \texttt{trans/}
directories contain language-specific code.


The other directories contain either standard Spoofax code that is copied into
the project or code that is generated from language 

\section{Language Concerns}

\begin{description}
\item[Syntax]
\item[Transformation]
\item[Names]
\item[Types]
\item[Dynamic semantics]
\end{description}


